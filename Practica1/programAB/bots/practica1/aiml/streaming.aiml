<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">
  
<!-- Consultar sinopsis -->
  <category>
    <pattern>De que [va trata] (la serie) [<set>seriesprimevideo</set> <set>seriesnetflix</set>]</pattern>
    <template><srai>DECODE <map><name><star/></name>sinopsis</map></srai></template>
  </category>

  <category>
    <pattern>De que [va trata] (la serie) *</pattern>
    <template>
      <think>
	<set name="tituloserie"><star/></set>
	<set name="topic">anadirserie</set>
      </think>
      La serie <get name="tituloserie"/> no esta en el catalogo. Quieres anadirla?
    </template>
  </category>

<!-- Anadir serie -->
  <topic name="anadirserie">
  <category>
    <pattern>^ [si vale ok] ^</pattern>
    <template>
     Ok, crea en la carpeta maps un archivo llamado <get name="tituloserie"/>.txt. Cuando hayas terminado reiniciame y al volver, pideme que anada la serie <get name="tituloserie"/>.
    </template>
  </category>

  <category>
    <pattern>^ no ^</pattern>
    <template>
      Ok.
      <think><set name="topic">anadirserie</set></think>
    </template>
  </category>
  </topic>

  <category>
    <pattern>Anade la serie [<set>seriesnetflix</set> <set>seriesprimevideo</set>]</pattern>
    <template>
      La serie <star/> ya esta en el catalogo.
    </template>
  </category>

  <category>
    <pattern>Anade la serie *</pattern>
    <template>
      <think><set name="tituloserie"><star/></set></think>
      Asegurate de haber creado un archivo llamado <get name="tituloserie"/>.txt en la carpeta maps.
      Te voy a preguntar datos sobre la serie <get name="tituloserie"/>. Indicame que plataforma la ofrece.
      <think><set name="topic">plataforma</set></think>
    </template>
  </category>
  
  <topic name="plataforma">
    <category>
      <pattern>*</pattern>
      <template>
	<think>
	  <set var="plataforma"><star/></set>
	  <condition var="plataforma">
	    <li value="netflix">
	      <set var="fichero">seriesnetflix</set>
	      <set var="estado">correcto</set>
	    </li>
	    <li value="prime video">
	      <set var="fichero">seriesprimevideo</set>
	      <set var="estado">correcto</set>
	    </li>
	    <li><set var="estado">error</set></li>
	  </condition>
	</think>

	<condition var="estado">
	  <li value="correcto">
	    <addtoset>
	      <name><get var="fichero"/></name>
	      <key><get name="tituloserie"/></key>
	    </addtoset>
	    Muy bien, dime a que generos pertenece. (Separa los generos por espacios)
	    <think><set name="topic">genero</set></think>
	  </li>
	  <li>Lo siento, solo conozco las plataformas Netflix y Prime Video.</li>
	</condition>
      </template>
    </category>     
  </topic>

  <topic name="genero">
    <category>
      <pattern>*</pattern>
      <template>
	<addtomap>
	  <name><get name="tituloserie"/></name>
	  <key>genero</key>
	  <value><srai>CODE_FIELDS <star/></srai></value>
	</addtomap>
	Dime de que que va la serie.
	<think><set name="topic">sinopsis</set></think>
      </template>
    </category>
  </topic>

  <topic name="sinopsis">
    <category>
      <pattern>*</pattern>
      <template>
	<addtomap>
	  <name><get name="tituloserie"/></name>
	  <key>sinopsis</key>
	  <value><srai>CODE <star/></srai></value>
	</addtomap>
	Dime la lista de idiomas en los que esta disponible el audio de la serie. (Separados por espacios)
	<think><set name="topic">idiomas</set></think>
      </template>
    </category>
  </topic>

  <topic name="idiomas">
    <category>
      <pattern>*</pattern>
      <template>
	<addtomap>
	  <name><get name="tituloserie"/></name>
	  <key>idiomas</key>
	  <value><srai>CODE_FIELDS <star/></srai></value>
	</addtomap>
	Dime la lista de subtitulos en los que esta disponible la serie. (Separados por espacios)
	<think><set name="topic">subtitulos</set></think>
      </template>
    </category>
  </topic>

  <topic name="subtitulos">
    <category>
      <pattern>*</pattern>
      <template>
	<addtomap>
	  <name><get name="tituloserie"/></name>
	  <key>subtitulos</key>
	  <value><srai>CODE_FIELDS <star/></srai></value>
	</addtomap>
	Si conoces una direccion web de la serie indicamela.
	<think><set name="topic">web</set></think>
      </template>
    </category>
  </topic>

  <topic name="web">
    <category>
      <pattern>*</pattern>
      <template>
	<addtomap>
	  <name><get name="tituloserie"/></name>
	  <key>web</key>
	  <value><star/></value>
	</addtomap>
	Ya he creado la informacion basica de la serie, si quieres anadir capitulos me lo dices.
	<think><set name="topic">capitulos</set></think>
      </template>
    </category>

    <category>
      <pattern>^ no ^</pattern>
      <template>
	Ya he creado la informacion basica de la serie, si quieres anadir capitulos me lo dices.
	<think><set name="topic">capitulos</set></think>
      </template>
    </category>
  </topic>

  <topic name="capitulos">
    <category>
      <pattern>^ [si vale ok] ^</pattern>
      <template>
	Anadiendo capitulo a la temporada 1 de <get name="tituloserie"/>.
	<srai>Introduce un nuevo capitulo de la temporada 1 de <get name="tituloserie"/></srai>
      </template>
    </category>

    <category>
      <pattern>^ no ^</pattern>
      <template>
	Ok.
	<think><set name="topic">unknown</set></think>
      </template>
    </category>
  </topic>

  
  <!-- Anadir capiulo -->
  <category>
    <pattern>[Anade Introduce] un (nuevo) capitulo [de a en] la temporada <set>number</set> de (la serie) [<set>seriesnetflix</set> <set>seriesprimevideo</set>]</pattern>
    <template>
      <think>
	<set name="topic">titcap</set>
	<set name="tituloserie"><star index="2"/></set>
	<set name="temporada"><star index="1"/></set>
	<set name="actual"><map><name><get name="tituloserie"/></name>temporada<get name="temporada"/></map></set>
	<condition name="actual">
	<li value="unknown">
	  <set name="primero"></set>
	  <addtomap>
	    <name><get name="tituloserie"/></name>
	    <key>temporada<get name="temporada"/></key>
	    <value></value>
	  </addtomap>
	</li>
	<li><set name="primero">@</set></li>
	</condition>
      </think>
      Dime el titulo del capitulo.
    </template>
  </category>

  
  <category>
    <pattern>[Anade Introduce] un nuevo capitulo [de a en] la temporada <set>number</set> de *</pattern>
    <template>
      <think>
      <set name="tituloserie"><star index="2"/></set>
      <set name="topic">anadirserie</set>
      </think>
      La serie <get name="tituloserie"/> no esta en el catalogo. Quieres anadirla?
    </template>
  </category>
  

  <topic name="titcap">
    <category>
      <pattern>*</pattern>
      <template>
	<think>
	<set name="titulo"><star/></set>
	<set name="topic">durcap</set>
	</think>
	Dime la duracion del capitulo.
      </template>
    </category>
  </topic>
  

  <topic name="durcap">
    <category>
      <pattern><set>number</set></pattern>
      <template>
	<think>
	<set name="duracion"><star/></set>
	<set name="topic">unknown</set>
	</think>
	Este capitulo ya esta disponible en la plataforma.	
	<modifymap>
	  <name><get name="tituloserie"/></name>
	  <key>temporada<get name="temporada"/></key>
	  <value><srai> CODE <map><name><get name="tituloserie"/></name>temporada<get name="temporada"/></map><get name="primero"/><get name="titulo"/></srai>@<get name="duracion"/></value>
	</modifymap>
      </template>
    </category>
  </topic>

  
</aiml>
